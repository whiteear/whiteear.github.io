<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="whiteear" />
    <meta name="viewport" content="width=device-width"> 
    <title>发明人Linus Torvalds给出的Git使用建议 | whiteear</title>
	<!-- Jim disable
	script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js?autoload=true&skin=Desert"></script-->
    <link href="/feed/" rel="alternate" title="whiteear" type="application/atom+xml" />
    <link rel="shortcut icon" href="/favicon.ico"/>
	<link rel="icon" href="http://blog.sevenche.com/favicon.ico"/>

    <link rel="stylesheet" href="/media/css/highlight.css">
    <link href='/media/webfonts/ss-social.css' rel='stylesheet'>
    <link href='/media/webfonts/ss-standard.css' rel='stylesheet'>

    <script language="JavaScript"><!--
        if (navigator.userAgent.match(/iPhone|iPod|Android|IEMobile/i)) {
            document.write("<link href=\"/media/css/screen-mobil.css\" rel=\"stylesheet\">");
        } else {
            document.write("<link href=\"/media/css/screen.css\" rel=\"stylesheet\">");
        }
        // -->
    </script>

    <!--script type="text/javascript" src="/media/js/jquery-1.7.1.min.js"></script-->
    <script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.7.2.min.js"></script>
	
  </head>
  <body>
    <div id="container">
      <div id="main" role="main">
        <header>
        <div class="buttons">
          <a href="/" class="ss-icon" title="Go to homepage">home</a>
          <a href="/categories" class="ss-icon" title="Category" >list</a>
          <a href="/tags" class="ss-icon" title="Tag Cloud" >tags</a>
          <a href="/guestbook" class="ss-icon" title="Guest Book" >talk</a>
          <a href="/about" class="ss-icon" title="About" >user</a>
          <a href="/feed" class="ss-icon" title="Subscribe by RSS" >rss</a>
        </div>
        <h1>发明人Linus Torvalds给出的Git使用建议</h1>
        </header>
        <hr>
        <article class="content">
        <section class="post">
<blockquote><p><strong>导读</strong></p>

<ul>
<li>博主自己大约花了二十分钟用来阅读本文，如果你时间不够，请先收藏。</li>
<li>本文分为两部分，第一部分较为概略，一般要读到第二部分时才能明白前面说的是什么。</li>
<li>本文精彩的论述了什么时候用rebase，什么时候不能用。同时分析了使用Pull,Merge,Push的时机。</li>
</ul>
</blockquote>

<h3>引言</h3>

<p>如何更好的使用Git？作为Git的发明人Torvalds会给出什么样的建议呢？
<a href="http://torvalds-family.blogspot.sg/">Linus Torvalds的博客</a>和他的Mail list里提到过使用Git的一些注意事项。（该Blog可能国内被墙）</p>

<p>现在开始挖坟啦！话说2009年的某一天Linux 2.6.31内核的分枝合并工作进行的很顺利（你知道现在Linux内核的版本号吗？），Torvalds的心情大好于是就写下一篇与Git有一点点关系的<a href="http://torvalds-family.blogspot.sg/2009/06/happiness-is-warm-scm.html">blog</a>，然后后面有两个人在回复里问Git应该怎么用呢？</p>

<h3>问题</h3>

<blockquote><p>As a Git n00b, would be nice to see a post on what these "rules that work" are.</p></blockquote>

<p>Linus Torvalds刚好心情大好就给整理了一下。</p>

<h3>Linus回答</h3>

<p>It's basically a matter of finding the right balance on a couple of different axises:</p>

<p>"clean history":</p>

<p>Balancing the need to clean up after mistakes (aka "rewriting history") using tools like 'git rebase', but then not doing it so much that you actually rewrite other peoples commits or lose all sight of the important history (like the fact that you tested one particular test, and if you then rewrite the history, all your testing is now dubious).</p>

<p>"Merging too much vs too little":</p>

<p>Merging is nice, because if you have concurrent development, a merge will tie the two branches together and allows you to test and develop on top of both changes.</p>

<p>But the downside is that merging too eagerly means that two separate branches that are for two different features are now tied together, and you can never separate the two (at least without re-doing the whole history).</p>

<p>So merging too much results in a very messy history, where you can't see what the actual different "topics" were. And it results in a tree where upstream (that is - me) can't review and pull the features one by one.</p>

<p>There's a few rants and rules about this that I did on the mailing lists last merge window. See for example <a href="http://www.mail-archive.com/dri-devel@lists.sourceforge.net/msg39091.html">rant</a></p>

<h3>另一个Mail List里的意见</h3>

<p>上面写的有些概括，这里其实是对上文的解释。</p>

<h3>邮件上下文</h3>

<blockquote><p>My plans from now on are just to send you non-linear trees, whenever I
merge a patch into my next tree thats when it stays in there, I'll pull
Eric's tree directly into my tree and then I'll send the results, I
thought we cared about a clean merge history but as I said without some
document in the kernel tree I've up until now had no real idea what you
wanted.</p></blockquote>

<h3>Linus回答</h3>

<blockquote><p>注意Linus的原文就是用<em>Markdown</em>格式写的，下面是原文，我没有加入任何Markdown格式。说明Linus在写邮件的时候是极为注意细节的。大家可以去查看<a href="http://www.mail-archive.com/dri-devel@lists.sourceforge.net/msg39091.html">原文的Raw格式</a> <br/>
另外如果下文提到的<em>rebase</em>你不是特别清楚的话，请参考:<a href="http://http://blog.sevenche.com/2014/03/Git_merge_--squash_and_git_rebase/">git merge --squash and git rebase explained</a></p></blockquote>

<p>I want clean history, but that really means (a) clean and (b) history.</p>

<p>People can (and probably should) rebase their <em>private</em> trees (their own
work). That's a <em>cleanup</em>. But never other peoples code. That's a "destroy
history"</p>

<p>So the history part is fairly easy. There's only one major rule, and one
minor clarification:</p>

<ul>
<li><p>You must never EVER destroy other peoples history. You must not rebase
commits other people did. Basically, if it doesn't have your sign-off
on it, it's off limits: you can't rebase it, because it's not yours.</p>

<p>Notice that this really is about other peoples <em>history</em>, not about
other peoples <em>code</em>. If they sent stuff to you as an emailed patch,
and you applied it with "git am -s", then it's their code, but it's
<em>your</em> history.</p>

<p>So you can go wild on the "git rebase" thing on it, even though you
didn't write the code, as long as the commit itself is your private
one.</p></li>
<li><p>Minor clarification to the rule: once you've published your history in
some public site, other people may be using it, and so now it's clearly
not your <em>private</em> history any more.</p>

<p>So the minor clarification really is that it's not just about "your
commit", it's also about it being private to your tree, and you haven't
pushed it out and announced it yet.</p></li>
</ul>


<p>That's fairly straightforward, no?</p>

<p>Now the "clean" part is a bit more subtle, although the first rules are
pretty obvious and easy:</p>

<ul>
<li><p>Keep your own history readable</p>

<p>Some people do this by just working things out in their head first, and
not making mistakes. but that's very rare, and for the rest of us, we
use "git rebase" etc while we work on our problems.</p>

<p>So "git rebase" is not wrong. But it's right only if it's YOUR VERY OWN
PRIVATE git tree.</p></li>
<li><p>Don't expose your crap.</p>

<p>This means: if you're still in the "git rebase" phase, you don't push
it out. If it's not ready, you send patches around, or use private git
trees (just as a "patch series replacement") that you don't tell the
public at large about.</p></li>
</ul>


<p>It may also be worth noting that excessive "git rebase" will not make
things any cleaner: if you do too many rebases, it will just mean that all
your old pre-rebase testing is now of dubious value. So by all means
rebase your own work, but use <em>some</em> judgement in it.</p>

<p>NOTE! The combination of the above rules ("clean your own stuff" vs "don't
clean other peoples stuff") have a secondary indirect effect. And this is
where it starts getting subtle: since you most not rebase other peoples
work, that means that you must never pull into a branch that isn't already
in good shape. Because after you've done a merge, you can no longer rebase
you commits.</p>

<p>Notice? Doing a "git pull" ends up being a synchronization point. But it's
all pretty easy, if you follow these two rules about pulling:</p>

<ul>
<li><p>Don't merge upstream code at random points.</p>

<p>You should <em>never</em> pull my tree at random points (this was my biggest
issue with early git users - many developers would just pull my current
random tree-of-the-day into their development trees). It makes your
tree just a random mess of random development. Don't do it!</p>

<p>And, in fact, preferably you don't pull my tree at ALL, since nothing
in my tree should be relevant to the development work <em>you</em> do.
Sometimes you have to (in order to solve some particularly nasty
dependency issue), but it should be a very rare and special thing, and
you should think very hard about it.</p>

<p>But if you want to sync up with major releases, do a</p>

<pre><code> git pull linus-repo v2.6.29
</code></pre>

<p>or similar to synchronize with that kind of <em>non_random</em> point. That
all makes sense. A "Merge v2.6.29 into devel branch" makes complete
sense as a merge message, no? That's not a problem.</p>

<p>But if I see a lot of "Merge branch 'linus'" in your logs, I'm not
going to pull from you, because your tree has obviously had random crap
in it that shouldn't be there. You also lose a lot of testability,
since now all your tests are going to be about all my random code.</p></li>
<li><p>Don't merge <em>downstream</em> code at random points either.</p>

<p>Here the "random points" comment is a dual thing. You should not mege
random points as far as downstream is concerned (they should tell you
what to merge, and why), but also not random points as far as your tree
is concerned.</p>

<p>Simple version: "Don't merge unrelated downstream stuff into your own
topic branches."</p>

<p>Slightly more complex version: "Always have a <em>reason</em> for merging
downstream stuff". That reason might be: "This branch is the release
branch, and is <em>not</em> the 'random development' branch, and I want to
merge that ready feature into my release branch because it's going to
be part of my next release".</p></li>
</ul>


<p>See? All the rules really are pretty simple. There's that somewhat subtle
interaction between "keep your own history clean" and "never try to clean
up <em>other</em> proples histories", but if you follow the rules for pulling,
you'll never have that problem.</p>

<p>Of course, in order for all this to work, you also have to make sure that
the people you pull <em>from</em> also have clean histories.</p>

<p>And how do you make sure of that? Complain to them if they don't. Tell
them what they should do, and what they do wrong. Push my complaints down
to the people you pull from. You're very much allowed to quote me on this
and use it as an explanation of "do this, because that is what Linus
expects from the end result".</p>

<pre><code>                    Linus
</code></pre>

<h3>总结</h3>

<p>Linus特别注意提交历史的干净与可读，其中给出了rebase应该的使用场境。</p>

<blockquote><p>附本文相关文章--<a href="http://blog.sevenche.com/2014/02/Git-%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF%E5%9B%BE%E5%8F%8A%E4%B8%AD%E6%96%87%E8%B5%84%E6%96%99%E6%8E%A8%E8%8D%90/">Git-学习路线图及中文资料推荐</a></p></blockquote>

</section>
<section class="meta">
<hr/>
<!-- disable jim related info
<span class="author">
  <a href="http://blog.sevenche.com">whiteear</a> - 程序员，7年工作经验集中在Java, Android, C++，现就职于上海Avaya Emerging Product and Technology部门。
</span>
<br />
-->

<span class="license">
  Published under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">(CC) BY-NC-SA</a>
</span>

<span class="categories">
  in categories
  
  <a href="/categories/#Technology" title="Technology">Technology</a>&nbsp;
  
</span>


<span class="tags">
  tagged with 
  
  <a href="/tags/#Git" title="Git">Git</a>&nbsp;
  
</span>

<span class="time">
  <br/>
  <time datetime="2014-02-28">2014-02-28</time>
</span>
</section>
<section class="comment">
<!-- baidu JIA -->
<div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a title="分享到QQ空间" href="#" class="bds_qzone" data-cmd="qzone"></a><a title="分享到新浪微博" href="#" class="bds_tsina" data-cmd="tsina"></a><a title="分享到腾讯微博" href="#" class="bds_tqq" data-cmd="tqq"></a><a title="分享到人人网" href="#" class="bds_renren" data-cmd="renren"></a><a title="分享到微信" href="#" class="bds_weixin" data-cmd="weixin"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
<!-- end of baidu JIA -->

<!-- Duoshuo Comment BEGIN -->
	<div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"dashjim"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- Duoshuo Comment END -->
</section>


<script type="text/javascript">
$(function(){
  $(document).keydown(function(e) {
    var url = false;
        if (e.which == 37 || e.which == 74) {  // Left arrow and J
            
        url = 'http://whiteear.github.io//2014/02/Implement-QoS-On-Iptables/';
        
        }
        else if (e.which == 39 || e.which == 75) {  // Right arrow and K
            
        url = 'http://whiteear.github.io//2014/03/Git_merge_--squash_and_git_rebase/';
        
        }
        if (url) {
            window.location = url;
        }
  });
})

</script>

<style type="text/css">
/*resize the big pic*/
div.resized_image p {
  margin: 2px;
  margin-top: 0;
  font-size: 8px;
  /* Awesome icon from here: http://www.famfamfam.com/lab/icons/silk/ */
  background: url(http://i242.photobucket.com/albums/ff244/9861_omikron/error.png) no-repeat;
  padding-left: 20px;
  color: #333;
}
</style>
<script type="text/javascript">
//resize the big pic
$(window).load(function() {
  (
    function(maxht, maxwt, minht, minwt) {
      var imgs = document.getElementsByTagName('img');
      // Image resizing function
      var resize_image = function(img, newht, newwt) {
        img.height = newht;
        img.width  = newwt;
        $(img).wrap('<table><tr><td class="tborder"><div class="resized_image"><a href="' + img.src + '" target="_blank"></a></div></td></tr></table>');
        $(img).parent().before('<p>NOTE: This image was resized. To view it full-size, click on the image.</p>');
        //$(img).parent().after('<p style="text-align:right;background:none;margin:0;padding-right:3px">Image resizing script by <a href="http://aetus.net/217/programming/automatically-resize-large-images-with-javascript/">Aetus Designs</a>.</p>');
      };
      
      for (var i = 0; i < imgs.length; i++) {
        // Set a variable for the current image to make the code make more sense.
        var img = imgs[i];
        if (img.height > maxht || img.width > maxwt) {
          // Use Ratios to constraint proportions.
          var old_ratio = img.height / img.width;
          var min_ratio = minht / minwt;
          // If it can scale perfectly.
          if (old_ratio === min_ratio) {
            resize_image(img, minht, minwt);
          } 
          // We need to do some magic now.
          else {
            var newdim = [img.height, img.width];
            // Sort out the height first.
            newdim[0] = minht;
            // The logic behind this is that if ratio = ht / wt, then wt = ht / ratio.
            newdim[1] = newdim[0] / old_ratio;
            // Do we still have to sort out the width?
            if (newdim[1] > maxwt) {
              // Just do what we did with the height
              newdim[1] = minwt;
              newdim[0] = newdim[1] * old_ratio;
            }
            // So yeah, resize the image
            resize_image(img, newdim[0], newdim[1]);
          }
        }
      }
    }
  )(780, 780, 780, 780);
});
</script>

        </article>
      </div>

    <footer>
        <p><small>Powered by <a href="https://github.com/mojombo/jekyll">Jekyll</a> | Free hosted at <a href="https://github.com/dashjim">Github</a> | Copyright 2014 - 2014 by 
		<!-- *** Please Keep bellow link for at least 6 months! Thanks！*** -->
		<a href="http://blog.sevenche.com/about/">Template Maintained by Jim</a>
		
		| <span class="label label-info">2014-10-07 17:29:07 CST</span></small></p>
    </footer>

    </div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  /*ga('create', 'UA-47125213-1', 'sevenche.com');
  ga('send', 'pageview');*/

</script>
  </body>
</html>
